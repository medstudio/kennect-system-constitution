<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Formulas Docs | Hello Kennector</title>
    <meta name="description" content="Let&#39;s start playing around">
    <link rel="icon" type="image/png" sizes="64x64" href="/assets/favicon.png">
  <link rel="shortcut icon" type="image/png" sizes="64x64" href="/assets/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.8eb0d87d.css" as="style"><link rel="preload" href="/assets/js/app.409bad63.js" as="script"><link rel="preload" href="/assets/js/10.4d448ecd.js" as="script"><link rel="prefetch" href="/assets/js/11.c58d4a40.js"><link rel="prefetch" href="/assets/js/12.12ef2798.js"><link rel="prefetch" href="/assets/js/13.839d4ad7.js"><link rel="prefetch" href="/assets/js/14.84664bd3.js"><link rel="prefetch" href="/assets/js/15.334b5b7d.js"><link rel="prefetch" href="/assets/js/16.9188ed4d.js"><link rel="prefetch" href="/assets/js/17.09765858.js"><link rel="prefetch" href="/assets/js/18.09050abf.js"><link rel="prefetch" href="/assets/js/19.328b130b.js"><link rel="prefetch" href="/assets/js/2.7b21ce08.js"><link rel="prefetch" href="/assets/js/20.229d4fa9.js"><link rel="prefetch" href="/assets/js/21.b6d146db.js"><link rel="prefetch" href="/assets/js/22.bbcb1a69.js"><link rel="prefetch" href="/assets/js/23.2cc4e2fc.js"><link rel="prefetch" href="/assets/js/24.33ff386c.js"><link rel="prefetch" href="/assets/js/25.53e9781b.js"><link rel="prefetch" href="/assets/js/3.5a3439f9.js"><link rel="prefetch" href="/assets/js/4.931a76fd.js"><link rel="prefetch" href="/assets/js/5.4e2036ee.js"><link rel="prefetch" href="/assets/js/6.8495fe17.js"><link rel="prefetch" href="/assets/js/7.e3a938be.js"><link rel="prefetch" href="/assets/js/8.49181e46.js"><link rel="prefetch" href="/assets/js/9.3262212b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8eb0d87d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hello Kennector</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Liteweight Business Intellegence</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Forms, Surveys &amp; Quizes</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Journeys</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/journeys/overview.html" class="sidebar-link">Overview</a></li><li><a href="/journeys/manifest.html" class="sidebar-link">Writing Manifests for Journeys</a></li><li><a href="/journeys/formulas.html" aria-current="page" class="active sidebar-link">Using Formulas In Journeys</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/journeys/formulas.html#formulas-docs" class="sidebar-link">Formulas Docs</a></li><li class="sidebar-sub-header"><a href="/journeys/formulas.html#note" class="sidebar-link">NOTE</a></li><li class="sidebar-sub-header"><a href="/journeys/formulas.html#input-collecttion" class="sidebar-link">input_collecttion =&gt;</a></li><li class="sidebar-sub-header"><a href="/journeys/formulas.html#emp-name-emp-id-age-height-job-john-123-23-160-it-ron-124-26-172-fn" class="sidebar-link">empname | empid | age | height | job |
	John |  123   | 23  |  160   |  IT |
	Ron  |  124   | 26  |  172   |  FN |</a></li></ul></li><li><a href="/journeys/storage.html" class="sidebar-link">Writing Other Storage Targets in Manifests</a></li><li><a href="/journeys/inputConfig.html" class="sidebar-link">InputConfig in Manifests</a></li><li><a href="/journeys/dependencies.html" class="sidebar-link">Dependencies in Manifests</a></li><li><a href="/journeys/outputCollectionsNames.html" class="sidebar-link">Output Collections Names in Manifests</a></li><li><a href="/journeys/validators.html" class="sidebar-link">Validators in Manifests</a></li><li><a href="/journeys/masterDataMap.html" class="sidebar-link">MasterDataMap</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Data Warehouse &amp; Reports</span> <span class="arrow right"></span></p> <!----></div></li><li><a href="/contact.html" class="sidebar-link">Contact us</a></li></ul> </div> <div class="page"> <div class="content"><p>#formulas that can be used in the journey</p> <h2 id="formulas-docs"><a href="#formulas-docs" class="header-anchor">#</a> <strong>Formulas Docs</strong></h2> <h2 id="note"><a href="#note" class="header-anchor">#</a> <strong>NOTE</strong></h2> <h3 id="all-collections-from-the-dependency-array-specified-in-dependencies-md-should-be-preceded-by-core-or-master-while-using-in-the-process-js-file"><a href="#all-collections-from-the-dependency-array-specified-in-dependencies-md-should-be-preceded-by-core-or-master-while-using-in-the-process-js-file" class="header-anchor">#</a> All collections from the dependency array specified in <a href="/journeys/dependencies.html">dependencies.md</a> should be preceded by &quot;core_&quot; or &quot;master_&quot; while using in the process.js file.</h3> <h4 id="appenddata"><a href="#appenddata" class="header-anchor">#</a> appendData</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">appendData</span><span class="token punctuation">(</span><span class="token parameter">targetCollection<span class="token punctuation">,</span> refCollection<span class="token punctuation">,</span> outputCollection<span class="token punctuation">,</span> targetKeys<span class="token punctuation">,</span> refKeys</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">appendData</span><span class="token punctuation">(</span><span class="token string">'bigFilterData'</span><span class="token punctuation">,</span> <span class="token string">&quot;core_bigSalesData&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bigSalesData&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'Month'</span><span class="token punctuation">,</span> <span class="token string">'FY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Month'</span><span class="token punctuation">,</span> <span class="token string">'FY'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula appends the data from targetCollection into the refCollection on the target and ref keys making refCollection the outputCollection unless the outputCollection is specified.</p> <hr> <h4 id="aggregatebyecpipeline"><a href="#aggregatebyecpipeline" class="header-anchor">#</a> aggregateByEcPipeline</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">aggregateByEcPipeline</span> <span class="token punctuation">(</span><span class="token parameter">targetCollection<span class="token punctuation">,</span> outputCollection<span class="token punctuation">,</span> targetIndexes<span class="token punctuation">,</span> aggregationPipeline</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">aggregateByEcPipeline</span><span class="token punctuation">(</span><span class="token string">&quot;working_coll&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token comment">// this is indexing </span>
        <span class="token punctuation">[</span><span class="token string">&quot;PRODUCT_SKU_MASTER.PRODUCT&quot;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">&quot;PRODUCT_SKU_MASTER.DIVISION&quot;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">&quot;EMP_CODE&quot;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token comment">// this is the pipeline</span>
<span class="token punctuation">{</span>
    $unwind<span class="token operator">:</span> <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">'$BENEFITS'</span><span class="token punctuation">,</span>
        preserveNullAndEmptyArrays<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        includeArrayIndex<span class="token operator">:</span> <span class="token string">&quot;serial_no&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>This formula can run a aggregate pipeline on the targetCollection making targetCollection the outputCollection unless the outputCollection is specified. TargetIndexes can index fields on targetCollection</p> <hr> <h4 id="createindexes"><a href="#createindexes" class="header-anchor">#</a> createIndexes</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">createIndexes</span><span class="token punctuation">(</span><span class="token parameter">targetCollection<span class="token punctuation">,</span> targetIndexes</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">createIndexes</span><span class="token punctuation">(</span><span class="token string">&quot;master_hierarchy&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token string">&quot;MASTER_HRCY&quot;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula can index fields on targetCollection with specified keys in targetIndexes.</p> <hr> <h4 id="dropindexes"><a href="#dropindexes" class="header-anchor">#</a> dropIndexes</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">dropIndexes</span><span class="token punctuation">(</span><span class="token parameter">targetCollection</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">dropIndexes</span><span class="token punctuation">(</span><span class="token string">&quot;master_hierarchy&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formulas can drop all indexes on the target collection.</p> <hr> <h4 id="filter"><a href="#filter" class="header-anchor">#</a> filter</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">targetCollection<span class="token punctuation">,</span> outputCollection<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">&quot;master_hierarchy&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>e<span class="token punctuation">[</span><span class="token string">'FYY'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;3020&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula can run and filter records from the targetCollection and will put the output in targetCollection unless the outputCollection is specified.</p> <hr> <h4 id="lookup"><a href="#lookup" class="header-anchor">#</a> lookup</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">lookup</span><span class="token punctuation">(</span><span class="token parameter">targetCollection<span class="token punctuation">,</span> lookupCollection<span class="token punctuation">,</span> outputCollection<span class="token punctuation">,</span>targetArrayKeys<span class="token punctuation">,</span> lookupArrayKeys<span class="token punctuation">,</span>valuesToAddArray<span class="token punctuation">,</span> lookupMultipleValues<span class="token punctuation">,</span> newKeyHeaders</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">&quot;stockist_Data_With_Division&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sapSkuData&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Division'</span><span class="token punctuation">,</span> <span class="token string">'FY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Division'</span><span class="token punctuation">,</span> <span class="token string">'FY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'Product_Code'</span><span class="token punctuation">,</span> <span class="token string">'sku_name'</span><span class="token punctuation">,</span> <span class="token string">'Sap_Product_Code'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula can lookup from targetCollection to lookupCollection on the specific keys and also &quot;valuesToAddArray&quot; to bring keys from the &quot;lookupCollection&quot;. Can also look multiple values using &quot;lookupMultipleValues&quot; flag by passing 1 or 0.
&quot;newKeyHeaders&quot; to rename a few keys of the output collection.
By default targetCollection will be the output collection unless &quot;outputCollection&quot; is specified.</p> <hr> <h4 id="merge"><a href="#merge" class="header-anchor">#</a> merge</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token parameter">leftCollection<span class="token punctuation">,</span> keys1<span class="token punctuation">,</span> rightCollection<span class="token punctuation">,</span> keys2<span class="token punctuation">,</span> fields1<span class="token punctuation">,</span> fields2<span class="token punctuation">,</span> commonfields1<span class="token punctuation">,</span> commonfields2<span class="token punctuation">,</span> action<span class="token punctuation">,</span> outputCollection</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token string">&quot;hqSalesWithType&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'HQ SAP CODE'</span><span class="token punctuation">,</span> <span class="token string">'sku_code'</span><span class="token punctuation">,</span> <span class="token string">'Month'</span><span class="token punctuation">,</span> <span class="token string">'Year'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;filteredTarget&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'sap_code'</span><span class="token punctuation">,</span> <span class="token string">'sku'</span><span class="token punctuation">,</span> <span class="token string">'Month'</span><span class="token punctuation">,</span> <span class="token string">'Year'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'units'</span><span class="token punctuation">,</span> <span class="token string">'sr_units'</span><span class="token punctuation">,</span> <span class="token string">'er_units'</span><span class="token punctuation">,</span> <span class="token string">'br_units'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token string">'sr_value'</span><span class="token punctuation">,</span> <span class="token string">'er_value'</span><span class="token punctuation">,</span> <span class="token string">'br_value'</span><span class="token punctuation">,</span> <span class="token string">'Division'</span><span class="token punctuation">,</span> <span class="token string">'sku_name'</span><span class="token punctuation">,</span> <span class="token string">'FY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'target_units'</span><span class="token punctuation">,</span> <span class="token string">'target_value'</span><span class="token punctuation">,</span> <span class="token string">'FY'</span><span class="token punctuation">,</span> <span class="token string">'sku_name'</span><span class="token punctuation">,</span> <span class="token string">'Division'</span><span class="token punctuation">,</span><span class="token string">'Rate'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'fullOuterJoin'</span><span class="token punctuation">,</span> <span class="token string">&quot;hqSalesWithTar&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula can merge leftCollection into rightCOllection on the specified keys retaining the keys specified in fields1 and fields2 for left and right collection respectively and action specifies on which type of JOIN(innerJoin,leftJoin,fullOuterJoin,rightJoin) is to be done
By default leftCollection will be the output collection unless &quot;outputCollection&quot; is specified.</p> <hr> <h4 id="calculator"><a href="#calculator" class="header-anchor">#</a> calculator</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">calculator</span><span class="token punctuation">(</span><span class="token parameter">targetCollection<span class="token punctuation">,</span> outputCollection<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> keysToOperate<span class="token punctuation">,</span> operator<span class="token punctuation">,</span> metricsToOperate<span class="token punctuation">,</span> asIsValues<span class="token punctuation">,</span> newKeyHeaders</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">calculator</span><span class="token punctuation">(</span><span class="token string">&quot;master_past_sales_core&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;YTD&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'EMP_CODE'</span><span class="token punctuation">,</span> <span class="token string">'month'</span><span class="token punctuation">,</span> <span class="token string">'sku'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> month<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token constant">YTD</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Jun'</span><span class="token punctuation">,</span> <span class="token string">'Apr'</span><span class="token punctuation">,</span> <span class="token string">'May'</span><span class="token punctuation">,</span> <span class="token string">'Jul'</span><span class="token punctuation">,</span> <span class="token string">'Aug'</span><span class="token punctuation">,</span> <span class="token string">'Sep'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'units'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token string">'target_units'</span><span class="token punctuation">,</span> <span class="token string">'target_value'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'sku_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula group values based on &quot;keys&quot; array and perform &quot;sum&quot; operation on the metricsToOperate Array
and keeping a few values as is and also grouping a few values using a diffrent style by using keysToOperate array of keys
By default targetCollection will be the output collection unless &quot;outputCollection&quot; is specified.</p> <hr> <h4 id="addkeyswithformula"><a href="#addkeyswithformula" class="header-anchor">#</a> addKeysWithFormula</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">addKeysWithFormula</span><span class="token punctuation">(</span><span class="token parameter">targetCollection<span class="token punctuation">,</span> outputCollection<span class="token punctuation">,</span> newKeys</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">addKeysWithFormula</span><span class="token punctuation">(</span><span class="token string">&quot;inputSalesData&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span> newKey<span class="token operator">:</span> <span class="token string">'Month'</span><span class="token punctuation">,</span> formula<span class="token operator">:</span> <span class="token string">'Number(a.split(&quot;. &quot;)[1])'</span><span class="token punctuation">,</span> keys<span class="token operator">:</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">'Invoice Date'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span> newKey<span class="token operator">:</span> <span class="token string">'Year'</span><span class="token punctuation">,</span> formula<span class="token operator">:</span> <span class="token string">'Number(a.split(&quot;.&quot;)[2])'</span><span class="token punctuation">,</span> keys<span class="token operator">:</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">&quot;Invoice Date&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>This formula can add keys to a collection with a specified newKey and formula which will be run on each row of the targetCollection
By default targetCollection will be the output collection unless &quot;outputCollection&quot; is specified.</p> <hr> <h4 id="flatten"><a href="#flatten" class="header-anchor">#</a> flatten</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">targetCollection<span class="token punctuation">,</span>outputCollection<span class="token punctuation">,</span>columns_to_convert_into_rows<span class="token punctuation">,</span>new_column_name_value<span class="token punctuation">,</span>preserve_columns<span class="token punctuation">,</span>group_by_columns<span class="token punctuation">,</span>new_column_name_keys</span><span class="token punctuation">)</span>

<span class="token comment">//usage</span>
<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> formulas<span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token string">&quot;emp_kpi_calc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;result&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'doctor_coverage'</span><span class="token punctuation">,</span><span class="token string">&quot;field_working_days&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;frequency_coverage&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;team_frequency_coverage&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;team_doctor_coverage&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;emp_code&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Role&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;FY&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'parameter'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula is used to convert multiple columns of a row into multiple rows with a common column name. All &quot;columns_to_convert_into_rows&quot; inputs will become rows with their respective column name as value of these rows. Current values of these columns with become another column as provided in &quot;new_column_name_value&quot; . Columns to maintain as it is will be &quot;preserve_columns&quot;. And &quot;group_by_columns&quot; for final groupBy. &quot;new_column_name_keys&quot; will be the column name of converted columns.</p> <p>eg :</p> <h2 id="input-collecttion"><a href="#input-collecttion" class="header-anchor">#</a> input_collecttion =&gt;</h2> <h2 id="emp-name-emp-id-age-height-job-john-123-23-160-it-ron-124-26-172-fn"><a href="#emp-name-emp-id-age-height-job-john-123-23-160-it-ron-124-26-172-fn" class="header-anchor">#</a> emp_name | emp_id | age | height | job |
John |  123   | 23  |  160   |  IT |
Ron  |  124   | 26  |  172   |  FN |</h2> <p>Run =&gt;</p> <p>() =&gt; formulas.flatten(&quot;input_collecttion&quot;, &quot;output_collection&quot;, ['age',&quot;height&quot;,&quot;job&quot;],'value', [&quot;emp_id&quot;,&quot;emp_name&quot;], [],'parameter')</p> <p>output_collection =&gt;</p> <hr> <p>emp_name | emp_id | parameter | value
John  |  123   |  age	  |  23
John  |  123   |  height	  |  160
John  |  123   |  job	  |  IT
Ron   |  124   |  age	  |  26
Ron   |  124   |  height	  |  172
Ron   |  124   |  job	  |  FN</p> <hr> <h4 id="windarray"><a href="#windarray" class="header-anchor">#</a> windArray</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">windArray</span><span class="token punctuation">(</span><span class="token parameter">targetCollection<span class="token punctuation">,</span> outputCollection<span class="token punctuation">,</span> aggregationKeys<span class="token punctuation">,</span> windKeyDetails<span class="token punctuation">,</span> asIsValues</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula can reverse the changes done by flatten
By default targetCollection will be the output collection unless &quot;outputCollection&quot; is specified.</p> <hr> <h4 id="buildhierarchy"><a href="#buildhierarchy" class="header-anchor">#</a> buildHierarchy</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">buildHierarchy</span><span class="token punctuation">(</span><span class="token parameter">targetCollection<span class="token punctuation">,</span> outputCollection<span class="token punctuation">,</span> key<span class="token punctuation">,</span> hierarchyKey<span class="token punctuation">,</span> keysToKeep<span class="token punctuation">,</span> depth</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">buildHierarchy</span><span class="token punctuation">(</span><span class="token string">&quot;hierarchyWiseData&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">'Position_No'</span><span class="token punctuation">,</span> <span class="token string">'Boss_No'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'Role'</span><span class="token punctuation">,</span> <span class="token string">'HQ CODE'</span><span class="token punctuation">,</span> <span class="token string">'Year'</span><span class="token punctuation">,</span> <span class="token string">'Count'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula can create parent child hierarchy keeping few values as is and can also specify depth.
By default targetCollection will be the output collection unless &quot;outputCollection&quot; is specified.</p> <hr> <h4 id="deletefields"><a href="#deletefields" class="header-anchor">#</a> deleteFields</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">deleteFields</span><span class="token punctuation">(</span><span class="token parameter">collectionName<span class="token punctuation">,</span> fieldNames</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">deleteFields</span><span class="token punctuation">(</span><span class="token string">&quot;hierarchyWiseData&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;USER_ID&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;EMP_ID&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula can delete fields from a row in targetCollection</p> <hr> <h4 id="renamefields"><a href="#renamefields" class="header-anchor">#</a> renameFields</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">renameFields</span><span class="token punctuation">(</span><span class="token parameter">collectionName<span class="token punctuation">,</span> updateObject</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">renameFields</span><span class="token punctuation">(</span><span class="token string">&quot;hierarchyWiseData&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;USER_NO&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user_id&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula can renames fields in targetCollection.
rename object format &quot;old_name&quot;: &quot;new_name&quot;</p> <hr> <h4 id="clearcollection"><a href="#clearcollection" class="header-anchor">#</a> clearCollection</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">clearCollection</span><span class="token punctuation">(</span><span class="token parameter">collectionName</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">clearCollection</span><span class="token punctuation">(</span><span class="token string">&quot;hierarchyWiseData&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula deletes all records from a collection.</p> <hr> <h4 id="schemequery"><a href="#schemequery" class="header-anchor">#</a> schemeQuery</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">schemeQuery</span><span class="token punctuation">(</span><span class="token parameter">aggregateArray</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">schemeQuery</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    $unwind<span class="token operator">:</span><span class="token punctuation">{</span>
        path<span class="token operator">:</span><span class="token string">&quot;$USER_ID&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>This formula can run a aggregate pipeline on the schemes collection.</p> <hr> <h4 id="renamecollection"><a href="#renamecollection" class="header-anchor">#</a> renameCollection</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//definition</span>
<span class="token keyword">function</span> <span class="token function">renameCollection</span><span class="token punctuation">(</span><span class="token parameter">targetCollection<span class="token punctuation">,</span> renamedName<span class="token punctuation">,</span> dropTarget <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> processMode <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//usage</span>
formulas<span class="token punctuation">.</span><span class="token function">renameCollection</span><span class="token punctuation">(</span><span class="token string">&quot;WORKING_COLLECTION&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TRIAL_INC_SUMMARY&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This formula can rename a target collection to a new name deleting the collection of the same name as &quot;renamedName&quot;</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/journeys/manifest.html" class="prev">
          Writing Manifests for Journeys
        </a></span> <span class="next"><a href="/journeys/storage.html">
          Writing Other Storage Targets in Manifests
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.409bad63.js" defer></script><script src="/assets/js/10.4d448ecd.js" defer></script>
  </body>
</html>
